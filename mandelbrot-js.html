<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JavaScript Mandelbrot Viewer</title>
    <style>
        body { background-color: #333; color: #fff; text-align: center; font-family: Arial, sans-serif; }
        canvas { border: 1px solid #fff; cursor: crosshair; }
        .controls { margin: 20px; }
        .info { margin: 10px; font-size: 14px; color: #ccc; }
    </style>
</head>
<body>
    <h1>Mandelbrot Set Visualization</h1>
    <div class="info">Click on the fractal to zoom in! Press 'R' to reset.</div>
    <canvas id="mandelbrotCanvas" width="800" height="600"></canvas>
    <div class="controls">
        <button onclick="resetView()">Reset View</button>
        <button onclick="increaseIterations()">More Detail</button>
        <button onclick="decreaseIterations()">Less Detail</button>
        <span id="info">Iterations: 100</span>
    </div>
    
    <script>
        const canvas = document.getElementById('mandelbrotCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        
        // State variables for the current view
        let current_x_min = -2.5;
        let current_x_max = 1.0;
        let current_y_min = -1.25;
        let current_y_max = 1.25;
        let max_iterations = 100;
        
        const zoomFactor = 2.0;
        
        function mandelbrotIteration(cx, cy, maxIter) {
            let x = 0, y = 0;
            let iterations = 0;
            
            while (x*x + y*y <= 4 && iterations < maxIter) {
                const xtemp = x*x - y*y + cx;
                y = 2*x*y + cy;
                x = xtemp;
                iterations++;
            }
            
            return iterations;
        }
        
        function getColor(iterations, maxIter) {
            if (iterations === maxIter) {
                return [0, 0, 0]; // Black for points in the set
            }
            
            // Create a smooth color gradient
            const ratio = iterations / maxIter;
            const r = Math.floor(255 * (0.5 + 0.5 * Math.sin(3 * ratio)));
            const g = Math.floor(255 * (0.5 + 0.5 * Math.sin(3 * ratio + 2)));
            const b = Math.floor(255 * (0.5 + 0.5 * Math.sin(3 * ratio + 4)));
            
            return [r, g, b];
        }
        
        function drawMandelbrot() {
            console.log(`Drawing fractal: x:[${current_x_min.toFixed(6)}, ${current_x_max.toFixed(6)}], y:[${current_y_min.toFixed(6)}, ${current_y_max.toFixed(6)}], iterations: ${max_iterations}`);
            
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;
            
            const x_range = current_x_max - current_x_min;
            const y_range = current_y_max - current_y_min;
            
            for (let py = 0; py < height; py++) {
                for (let px = 0; px < width; px++) {
                    // Map pixel coordinates to complex plane
                    const cx = current_x_min + (px / width) * x_range;
                    const cy = current_y_min + (py / height) * y_range;
                    
                    // Calculate Mandelbrot iterations
                    const iterations = mandelbrotIteration(cx, cy, max_iterations);
                    
                    // Get color for this point
                    const [r, g, b] = getColor(iterations, max_iterations);
                    
                    // Set pixel in ImageData
                    const index = (py * width + px) * 4;
                    data[index] = r;     // Red
                    data[index + 1] = g; // Green
                    data[index + 2] = b; // Blue
                    data[index + 3] = 255; // Alpha
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            document.getElementById('info').textContent = `Iterations: ${max_iterations}`;
        }
        
        function resetView() {
            current_x_min = -2.5;
            current_x_max = 1.0;
            current_y_min = -1.25;
            current_y_max = 1.25;
            drawMandelbrot();
        }
        
        function increaseIterations() {
            max_iterations = Math.min(max_iterations + 50, 1000);
            drawMandelbrot();
        }
        
        function decreaseIterations() {
            max_iterations = Math.max(max_iterations - 50, 50);
            drawMandelbrot();
        }
        
        // Zoom functionality
        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;
            
            // Convert pixel coordinates to complex plane coordinates
            const x_range = current_x_max - current_x_min;
            const y_range = current_y_max - current_y_min;
            const clicked_real = current_x_min + (mouseX / width) * x_range;
            const clicked_imag = current_y_min + (mouseY / height) * y_range;
            
            // Calculate new ranges (zoom in by factor)
            const new_x_range = x_range / zoomFactor;
            const new_y_range = y_range / zoomFactor;
            
            // Center the new view on the clicked point
            current_x_min = clicked_real - new_x_range / 2;
            current_x_max = clicked_real + new_x_range / 2;
            current_y_min = clicked_imag - new_y_range / 2;
            current_y_max = clicked_imag + new_y_range / 2;
            
            drawMandelbrot();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            switch(event.key.toLowerCase()) {
                case 'r':
                    resetView();
                    break;
                case '+':
                case '=':
                    increaseIterations();
                    break;
                case '-':
                    decreaseIterations();
                    break;
            }
        });
        
        // Initial draw
        drawMandelbrot();
    </script>
</body>
</html>
